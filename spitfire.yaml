# Global provisioning configuration template.
#
# Copy this file to config.yaml or <hostname>.yaml and adjust values as needed.
# Values in this file provide defaults. Create an additional YAML file named
# after the current host (e.g. fury.yaml) in the same directory to override
# specific settings per machine.
#
# Boolean flags accept true/false. Omit or set to null to inherit defaults.

profiles:
  - server
  - dev

steps:
  AdminGroupNopass:
    # Automatically add the invoking user to the passwordless admin group.
    adminGroup: admin
    addCurrentUser: true
    # Additional accounts to add to the admin group.
    users:
      - sysadmin

  Essentials:
    # Install baseline CLI packages required on all systems.
    packages:
      # Use "<package> alias <target>" to install a package, remove any package owning the target command, and point update-alternatives at the package's primary binary.
      # Use "<package> alias <source> -> <target>" to override the source command.
      - curl
      - wget
      - zip
      - unzip
      - rsync
      - ca-certificates
      - gnupg
      - apt-transport-https
      - neovim alias vim

  GitPrompt:
    # Configure a Git-aware shell prompt sourced from ~/.bashrc.
    enabled: true
    promptFile: ~/.git-prompt.sh
    bashrcPath: ~/.bashrc

  SdkmanInstall:
    # Ensure SDKMAN is present for managing language runtimes.
    enabled: true

  SdkmanMavenInstall:
    # Manage Maven installation via SDKMAN.
    version: 3.9.11
    enabled: true

  SdkmanJavaInstall:
    # Manage Java runtimes via SDKMAN.
    defaultJava: 17.0.16-tem
    javaVersions:
      - 17.0.16-tem
      - 21.0.8-tem
      - 25-tem
    enabled: true

  Insomnia:
    # Install the Insomnia API client.
    enabled: true

  GoogleChromeInstall:
    # Install Google Chrome Stable via the Google apt repository.
    enabled: false

  JetbrainsToolbox:
    # Install JetBrains Toolbox for IDE management.
    enabled: true

  DebianMirror:
    # Configure and serve a local Debian apt mirror via Apache.
    enabled: true
    siteFqdn: mirror.dublinux.lan
    mirrorRoot: /data/mirrors
    distributions:
      - bookworm
      - trixie
    components:
      - main
      - contrib
      - non-free
      - non-free-firmware
    includeUpdates: true
    includeBackports: true
    includeContents: true
    securitySuites:
      - bookworm-security
      - trixie-security
    threads: 20
    runInitialSync: true
    cronEnabled: true

  NvidiaDriverInstall:
    # Install NVIDIA drivers for Debian 13 using the Groovy runbook step.
    enabled: true

  SambaShares:
    # Configure Samba shares (standalone, share-level access).
    enabled: true
    workgroup: DUBLINUX
    sambaUsers:
      - user:
          name: callen
      - user:
          name: jallen
      - user:
          name: lredford
      - user:
          name: mallen
      - user:
          name: rallen
    shares:
      - share:
          name: callen
          path: /data/share/callen
          browseable: true
          readOnly: false
          validUsers:
            - callen
          forceUser: callen
          forceGroup: users
      - share:
          name: jallen
          path: /data/share/jallen
          browseable: true
          readOnly: false
          validUsers:
            - jallen
          forceUser: jallen
          forceGroup: users
      - share:
          name: lredford
          path: /data/share/lredford
          browseable: true
          readOnly: false
          validUsers:
            - lredford
          forceUser: lredford
          forceGroup: users
      - share:
          name: mallen
          path: /data/share/mallen
          browseable: true
          readOnly: false
          validUsers:
            - mallen
          forceUser: mallen
          forceGroup: users
      - share:
          name: rallen
          path: /data/share/rallen
          browseable: true
          readOnly: false
          validUsers:
            - rallen
          forceUser: rallen
          forceGroup: users

  NfsServer:
    # Export /data via NFS for trusted hosts.
    enabled: true
    defaultOptions: rw,sync,no_subtree_check,no_root_squash
    exports:
      - path: /data
        clients:
          - tornado

  Jellyfin:
    # Install Jellyfin Server from the upstream repository.
    enabled: true
    release: trixie
    packages:
      - jellyfin
    apacheProxy:
      enabled: true
      documentRoot: /var/www/hosts/jellyfin
      backendHost: 10.0.0.1
      backendPort: 8096
      websocketPath: /socket
      siteName: jellyfin.dublinux.net
      accessLog: /var/log/apache2/jellyfin.dublinux.net-access.log
      errorLog: /var/log/apache2/jellyfin.dublinux.net-error.log
      domains:
        - host: jellyfin.dublinux.lan
          https: false
          certbot: false
          redirect: false
          accessLog: /var/log/apache2/jellyfin.dublinux.lan-access.log
          errorLog: /var/log/apache2/jellyfin.dublinux.lan-error.log
        - host: jellyfin.dublinux.net
          https: true
          certbot: true
          redirect: true
      certbotEnabled: true
      certbotEmail: admin@dublinux.net
      certbotStaging: false
      certbotExtraArgs:
        - "--force-renewal"
  EspReplicate:
    # Replicate the EFI System Partition and install GRUB on matching disks.
    # Use true to apply, false to skip, or info to display planned actions only.
    enabled: true
    bootloaderId: debian
    autoApprove: false
    
